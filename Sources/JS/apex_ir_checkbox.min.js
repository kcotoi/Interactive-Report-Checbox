apex.kcUtils.irCheckbox={},apex.kcUtils.irCheckbox.options=[],function(e,r,t,o,a,n,i,d,c){"use strict";var s=[],l=[];r.init=function(){r.reportId="#"+this.triggeringElement.id,e[r.reportId]={},e[r.reportId].context=this,e[r.reportId].resumeCallback=this.resumeCallback,e[r.reportId].refreshReport=this.action.attribute06,e[r.reportId].checkBoxColumnId=this.action.attribute02,e[r.reportId].rowSelectionEnabled=this.action.attribute07,e[r.reportId].ajax={id:this.action.ajaxIdentifier,running:!1,type:"RENDER_CHECKBOX"},e[r.reportId].pageItems=this.action.attribute08,o('Init Interactive Report Checbox for Report with Static ID "'+r.reportId+'"!'),"load"==this.browserEvent?r.irHasMultipleViews()||r.handleLoadEvent():r.irHasMultipleViews()||r.handleClickEvent()},r.getAllCheckboxes=function(){return a(r.reportId).find("td[headers*="+e[r.reportId].checkBoxColumnId+"] input")},r.getCheckboxElement=function(t){var o=a(e[r.reportId].context.browserEvent.target);return"INPUT"==o[0].nodeName?o:t.find("input")},r.getReportFilters=function(){return a(r.reportId).find("ul.a-IRR-controls").find('span[id*="control_text"]')},r.checkIfFiltersAreTheSame=function(e,r){var t=!0,o=[],a=[];return e.each(function(){o.push(this.textContent)}),r.each(function(){a.push(this.textContent)}),JSON.stringify(o)!==JSON.stringify(a)&&(t=!1),t},r.updateCheckedRecordsArray=function(e,a){var n={};n.id=e,a&&!t.isIdInArrayObj(s[r.reportId],n.id)?(s[r.reportId].push(n),o("irCk.updateCheckedRecordsArray -> Record Added: ",n)):a||(s[r.reportId]=jQuery.grep(s[r.reportId],function(e){return e.id!=n.id}),o("irCk.updateCheckedRecordsArray -> Record Removed: ",n))},r.updateStateOfAllChecboxes=function(e){r.getAllCheckboxes().each(function(){this.checked=e,r.updateCheckedRecordsArray(this.value,e)})},r.updateStateOfCheckboxHeader=function(n){var i=a(r.reportId).find("th#"+e[r.reportId].checkBoxColumnId),d=r.getAllCheckboxes();if(t.objExists(n)&&t.objExists(i))o("irCk.updateStateOfCheckboxHeader -> checkboxAllHeader exists , so we will set checkboxAllHeader to ",n),i.find("input")[0].checked=n;else if(t.objExists(d)){var c=d.length===d.filter(":checked").length;o("irCk.updateStateOfCheckboxHeader -> allCheckboxesChecked: ",c),t.objExists(i)&&(o("irCk.updateStateOfCheckboxHeader -> checkboxAllHeader exists , so we will set checkboxAllHeader to ",c),i.find("input")[0].checked=c)}a(window).trigger("apexwindowresized")},r.updateStateOfCheckbox=function(t){var n=t[0].checked,i=e[r.reportId].context.browserEvent;return"INPUT"!==a(i.target)[0].nodeName&&(o("irCk.updateStateOfCheckbox -> Target Element not input so we check input here ! $(lEvent.target): ",a(i.target)),n=t[0].checked=!n),n},r.createCheckbox=function(e){var r=document.createElement("input");return r.type="checkbox",r.value=e,r},r.renderSelections=function(){var e=r.getAllCheckboxes();o("irCk.renderSelections -> We will render selection for all Checkboxes: ",e),t.objExists(s[r.reportId])?(o("irCk.renderSelections -> Array with checked records for report "+r.reportId+" exists so we will check all records that are inside !"),e.each(function(){var e={};e.id=this.value,this.checked=t.isIdInArrayObj(s[r.reportId],e.id)})):o("irCk.renderSelections -> Array with checked records for report "+r.reportId+" does not exist so we will not render any selections!"),r.updateStateOfCheckboxHeader()},r.renderCheckboxes=function(n){var i=a(r.reportId).find("th#"+e[r.reportId].checkBoxColumnId),d=a(r.reportId).find("td[headers*="+e[r.reportId].checkBoxColumnId+"]");if(o('irCk.renderCheckboxes -> We will render checboxes for column "'+e[r.reportId].checkBoxColumnId+'"!'),t.objExists(i)){var c=r.createCheckbox("all");o('irCk.renderCheckboxes -> Target column header with Static ID "'+e[r.reportId].checkBoxColumnId+'" found and we will render checkbox!'),i.find("span").empty().append(c)}else apex.debug.error('irCk.renderCheckboxes -> Target column header with Static ID "'+e[r.reportId].checkBoxColumnId+'" not found!');t.objExists(d)?(o('irCk.renderCheckboxes -> Target column cells with Static ID "'+e[r.reportId].checkBoxColumnId+'" found and we will render checkboxes!'),d.each(function(){var e=this.textContent;this.className.includes("aggregate")||a(this).empty().append(r.createCheckbox(e))}),n&&r.renderSelections()):apex.debug.error('irCk.renderCheckboxes -> Target column cells with Static ID "'+e[r.reportId].checkBoxColumnId+'" not found!'),a(window).trigger("apexwindowresized")},r.doAjax=function(t,o){e[r.reportId].ajax.type=t;var a,n=e[r.reportId].ajax.id,i={p_clob_01:JSON.stringify(s[r.reportId]),x01:t};a={success:r.ajaxSuccess,error:r.ajaxError,async:o},e[r.reportId].ajax.running||(e[r.reportId].ajax.running=!0,apex.server.plugin(n,i,a))},r.ajaxSuccess=function(t,i,d){o("irCk.ajaxSuccess ajax.type: ",e[r.reportId].ajax.type),"SUBMIT_CHECKBOX"==e[r.reportId].ajax.type?apex.event.trigger(r.reportId,"ir_selection_changed"):"RENDER_CHECKBOX"==e[r.reportId].ajax.type?(s[r.reportId]=t,r.hasReportData()&&r.renderCheckboxes(!0)):"CLEAR_CHECKBOX"==e[r.reportId].ajax.type&&(s[r.reportId]=[],"Y"==e[r.reportId].refreshReport?a(r.reportId).trigger("apexrefresh"):r.hasReportData()&&(r.updateStateOfCheckboxHeader(!1),r.updateStateOfAllChecboxes(!1)),apex.event.trigger(r.reportId,"ir_selection_changed")),n.resume(e[r.reportId].resumeCallback,!1),e[r.reportId].ajax.running=!1},r.ajaxError=function(t,o,a){e[r.reportId].ajax.running=!1,n.handleAjaxErrors(a,o,t.errorMessage,e[r.reportId].resumeCallback)},r.irHasMultipleViews=function(){var e=a(r.reportId).find("div.a-IRR-controlGroup--views")[0],n=!1;return t.objExists()&&e.childElementCount>0&&(o("irCk.irHasMultipleViews -> We have multiple views for report : "+r.reportId+", this means that pivot,chart or group by view is enabled so we will not render checkboxes."),n=!0),o("irCk.irHasMultipleViews -> We don't have multiple views for report : "+r.reportId+",  we will render checkboxes."),n},r.hasReportData=function(){var e=!0,o=a(r.reportId).find("div.a-IRR-noDataMsg");return t.objExists(o)&&(e=!1),e},r.handleReportRefresh=function(){if(o("irCk.handleReportRefresh of Report : "+r.reportId),!r.irHasMultipleViews()&&r.hasReportData()){var e=r.getReportFilters(),t=r.checkIfFiltersAreTheSame(l[r.reportId],e);r.renderCheckboxes(t),t||(l[r.reportId]=e,r.clearCheckedRecordsArrayAjax("internal"))}},r.setReportIdToItems=function(e){var o;if(t.objExists(e)){o=e.split(",");for(var n=0;n<o.length;n++)a("#"+o[n])[0].setAttribute("data-report-id",r.reportId)}},r.handleLoadEvent=function(){r.doAjax("RENDER_CHECKBOX",!1),l[r.reportId]=r.getReportFilters(),a(e[r.reportId].context.triggeringElement).on("apexafterrefresh",function(){r.reportId="#"+this.id,r.handleReportRefresh()}),r.setReportIdToItems(e[r.reportId].pageItems)},r.handleClickEvent=function(){var n,i,d=e[r.reportId].context.browserEvent,c=a(d.target).closest("th#"+e[r.reportId].checkBoxColumnId),s=a(d.target).closest("tr");r.hasReportData()&&(t.objExists(c)?(o("irCk.handleClickEvent -> Checkbox column header Trigerred the event !"),n=r.getCheckboxElement(c),t.objExists(n)&&(i=r.updateStateOfCheckbox(n),r.updateStateOfAllChecboxes(i),r.doAjax("SUBMIT_CHECKBOX",!0))):t.objExists(s)&&("Y"==e[r.reportId].rowSelectionEnabled?(n=s.find("td[headers*="+e[r.reportId].checkBoxColumnId+"] input"),o("irCk.handleClickEvent -> Row selection is enabled, so we got element from triggering row ! Element : "+n)):(n=r.getCheckboxElement(a(d.target)),o("irCk.handleClickEvent -> Row selection is not enabled, so we only get the checkbox element only if the click is on the checkbox cell itself ! Element : "+n)),t.objExists(n)&&(i=r.updateStateOfCheckbox(n),r.updateCheckedRecordsArray(n.val(),i),r.doAjax("SUBMIT_CHECKBOX",!0),r.updateStateOfCheckboxHeader())))},r.clearCheckedRecordsArrayAjax=function(e,o){"item"==e?t.objExists(a(o))&&(r.reportId=o.dataset.reportId,r.doAjax("CLEAR_CHECKBOX",!1)):"internal"==e&&r.doAjax("CLEAR_CHECKBOX",!1)},apex.debug.LOG_LEVEL.APP_TRACE<=apex.debug.getLevel()&&t.functionLogger.addLoggingToNamespace(r)}(apex.kcUtils.irCheckbox.options,apex.kcUtils.irCheckbox,apex.kcUtils,apex.debug.info,apex.jQuery,apex.da,apex.server,apex.region);
